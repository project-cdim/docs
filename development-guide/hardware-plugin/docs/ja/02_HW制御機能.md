# 2. HW制御機能

本章では、HW制御機能のREST APIを概説したのち、プラグインが実装する機能を示します。

## 2.1. HW制御機能のREST API

HW制御機能のREST APIでプラグインに関わるものを以下に示します。

|No.|名称                       |URI                                         |METHOD|概要
|:-:|---------------------------|--------------------------------------------|:----:|---------------------------------------------------
| 1 |デバイスID一覧情報取得     |/cdim/api/v1/device-ids                     | GET  |デバイスIDの一覧を取得します。
| 2 |全デバイススペック情報取得 |/cdim/api/v1/devices                        | GET  |全デバイスのスペック情報を取得します。
| 3 |スペック情報取得           |/cdim/api/v1/devices/{deviceID}/specs       | GET  |デバイスのスペック情報を取得します。
| 4 |メトリック情報取得         |/cdim/api/v1/devices/{deviceID}/metrics     | GET  |デバイスのメトリック情報を取得します。
| 5 |リソース情報取得           |/cdim/api/v1/devices/{deviceID}             | GET  |デバイスのスペック情報とメトリック情報を取得します。
| 6 |構成変更制御               |/cdim/api/v1/cpu/{CPUDeviceID}/aggregations | PUT  |CPU装置とデバイスを接続または切断します。
| 7 |電源制御                   |/cdim/api/v1/devices/{deviceID}/power       | PUT  |デバイスの電源を制御します。
| 8 |OS起動確認                 |/cdim/api/v1/cpu/{CPUDeviceID}/is-os-ready  | GET  |OSの起動状態を取得します。

## 2.2. プラグインの概要

プラグインはクラスとして実装します([4.2 クラス構成](04_プラグインの構成.md#42-クラス構成)参照)。  
HW制御機能のREST APIは、デバイス情報の収集とデバイスの制御を行うにあたって、  
ハードウェア依存の処理が必要となったときに、対象となるデバイスに応じたプラグインを生成し、  
生成したプラグインのメソッドを呼び出すことにより、ハードウェア依存の処理をプラグインに委譲します。

以下にプラグインが実装するメソッドを示します。

### OOBプラグインのメソッド

|No.|名称                 |メソッド         |概要
|:-:|---------------------|-----------------|----------------------------------
| 1 |デバイス一覧情報取得 |get_device_info  |デバイスの一覧情報を取得します。
| 2 |スペック情報取得     |get_spec_info    |デバイスのスペック情報を取得します。
| 3 |メトリック情報取得   |get_metric_info  |デバイスのメトリック情報を取得します。
| 4 |電源状態取得         |get_power_state  |デバイスの電源状態を取得します。
| 5 |電源ON               |post_power_on    |デバイスの電源をONにします。
| 6 |電源OFF              |post_power_off   |デバイスの電源をOFFにします。
| 7 |CPUリセット          |post_cpu_reset   |CPUをリセットします。
| 8 |OSシャットダウン     |post_os_shutdown |OSをシャットダウンします。

### FMプラグインのメソッド

|No.|名称             |メソッド         |概要
|:-:|-----------------|-----------------|---------------------------------
| 1 |デバイス接続     |connect          |USP側ポートとDSP側ポートを接続します(※1参照)。
| 2 |デバイス切断     |disconnect       |USP側ポートとDSP側ポートを切断します(※1参照)。
| 3 |ポート情報取得   |get_port_info    |CXLスイッチのポート情報を取得します。
| 4 |スイッチ情報取得 |get_switch_info  |CXLスイッチ情報を取得します。

※1. USP: Upstream Switch Port, DSP: Downstream Switch Port
